@model IEnumerable<JJBookStore.ViewModels.ShopCartViewModel>

@{
    ViewBag.Title = "ManageShopCart";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<script>
    function qclick(flag, i, unit) {
        currentTotal = parseFloat(document.getElementById("total").innerHTML);
        if (flag) {
            document.getElementById(i).value++;
            if (document.getElementById(i + "check").checked) {
                document.getElementById("total").innerHTML = (currentTotal + unit).toFixed(2);
            }
        }
        else {
            if (document.getElementById(i).value > 1) {
                document.getElementById(i).value--;
                if (document.getElementById(i + "check").checked) {
                    document.getElementById("total").innerHTML = (currentTotal - unit).toFixed(2);
                }
            }
        }
        document.getElementById(i + "+subtotal").innerHTML = (document.getElementById(i).value * unit).toFixed(2);
    }

    function total(i) {
        currentTotal = parseFloat(document.getElementById("total").innerHTML);
        if (document.getElementById(i + "check").checked) {
            document.getElementById("total").innerHTML = (currentTotal + parseFloat(document.getElementById(i + "+subtotal").innerHTML)).toFixed(2);
        } else {
            document.getElementById("total").innerHTML = (currentTotal - parseFloat(document.getElementById(i + "+subtotal").innerHTML)).toFixed(2);
        }
    }
</script>

<h2>Manage Shopping Cart</h2>
@using (Html.BeginForm("SaveShopCart", "ShopCarts", FormMethod.Post, new { @class = "form-horizontal", role = "form" }))
{
    @Html.AntiForgeryToken()
    @Html.ValidationSummary(true, "", new { @class = "text-danger" })
    <table class="table">
        <tr>
            <th>
                @Html.DisplayNameFor(model => model.Title)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Quantity)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.Seller)
            </th>
            <th>
                @Html.DisplayNameFor(model => model.UnitPrice)
            </th>
            <th>
                <span>Sub Total</span>
            </th>
            <th>
                <span>Select</span>
            </th>
        </tr>
        @{int i = 0;}
        @foreach (var item in Model)
        {
            i++;
            @Html.HiddenFor(modelItem => item.ShopCartId)
            <tr>
                <td>
                    @Html.DisplayFor(modelItem => item.Title)
                    @Html.HiddenFor(modelItem => item.Title)
                </td>
                <td>
                    <input type="button" value="-" onclick="qclick(false,@i,@item.UnitPrice)">
                    @Html.TextBoxFor(modelItem => item.Quantity, new { id = i, @readonly = "readonly", style = "width:20px;text-align:center;" })
                    @Html.ValidationMessageFor(modelItem => item.Quantity, "", new { @class = "text-danger" })
                    <input type="button" value="+" onclick="qclick(true,@i,@item.UnitPrice)">
                </td>

                <td>
                    @Html.DisplayFor(modelItem => item.Seller)
                    @Html.HiddenFor(modelItem => item.Seller)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.UnitPrice)
                    @Html.HiddenFor(modelItem => item.UnitPrice)
                </td>
                <td>
                    <span id="@i+subtotal"> @(item.Quantity * item.UnitPrice)</span>
                </td>
                <td>
                    @Html.CheckBox("checked", new { id = i + "check", onclick = String.Format("total({0},{1})", i, item.UnitPrice) })
                </td>
            </tr>
        }
        <tr>
            <td align="right" colspan="4"><b>Total Price</b></td>
            <td>$<div id="total" style="float:right;">0.00</div></td>
        </tr>
        <tr>
            <td align="right" colspan="6">

                <input type="submit" value="Save Change" class="btn btn-default" />
                <!--<input type="submit" value="Remove" class="btn btn-default"
           onclick="return confirm('Do you really want to remove those items?')" />-->
            </td>
        </tr>
    </table>
}
<p>
    <a href="javascript:history.back()">Go Back</a>
</p>